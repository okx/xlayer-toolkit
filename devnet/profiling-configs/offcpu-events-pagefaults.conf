# Off-CPU Profiling: Page Faults and Memory Pressure
#
# This configuration captures page faults and memory-related events
# to identify when memory-mapped I/O (mmap) causes disk reads.
#
# Use this to understand:
# - Major faults: mmap'd pages read from disk (the "hidden" disk reads!)
# - Minor faults: mmap'd pages already in RAM cache
# - Memory pressure: when system needs to reclaim/swap memory

# === Page Fault Events ===
# Major faults = page fault requires disk I/O (mmap read from disk!)
# Minor faults = page fault resolved from RAM (no disk I/O)
major-faults
minor-faults

# === Memory Pressure Events ===
# These fire when system is low on memory and needs to reclaim pages
vmscan:mm_vmscan_direct_reclaim_begin
vmscan:mm_vmscan_direct_reclaim_end
vmscan:mm_vmscan_kswapd_wake

# === Optional: Page Writeback Events ===
# Uncomment to track when dirty pages are written back to disk
# WARNING: Can generate high event counts on write-heavy workloads
#
# writeback:writeback_dirty_folio
# writeback:writeback_dirty_inode
# writeback:writeback_write_inode
# writeback:writeback_written

# Note: Major faults with stack traces will show which reth functions
# are causing mmap'd disk reads (the reads missing from sys_enter_read!)
#
# Example stack trace:
#   major-faults:
#     ffffc6b51abc __filemap_get_folio    <- kernel reading from disk
#     1234567 reth_db::mdbx::get          <- reth function accessing mmap'd data
