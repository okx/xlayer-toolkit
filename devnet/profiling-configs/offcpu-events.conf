# Off-CPU Profiling Events Configuration
#
# This file defines which perf events to capture for off-CPU profiling.
# Each line starting with an event name will be included in the profiling.
# Lines starting with # are comments.
#
# Event Categories:
# - Lock Contention: futex events show when threads wait on locks
# - Disk I/O: fsync/fdatasync and block events show disk blocking
# - Scheduling: sched_switch shows context switches
#
# WARNING: Avoid high-frequency events like sys_enter_read/write
# as they can generate millions of samples per second!

# === Lock Contention Events ===
# These capture when Rust Mutex, RwLock, parking_lot locks block
# NOTE: Only capturing enter events to reduce sample count (~50% reduction)
#       Exit events provide little additional value for identifying contention sources
#       Stack traces at enter show which code is waiting on locks
# NOTE: futex_wait vs futex_waitv - older kernels use futex_wait, newer (6.1+) use futex_waitv
#       If you get "unknown tracepoint" error, check available events with:
#       docker exec <container> ls /sys/kernel/tracing/events/syscalls/ | grep futex
syscalls:sys_enter_futex
syscalls:sys_enter_futex_waitv

# === Disk Sync Events ===
# These capture blocking disk sync operations
syscalls:sys_enter_fsync
syscalls:sys_enter_fdatasync

# === Block I/O Events ===
# These capture actual disk I/O requests
block:block_rq_issue
block:block_rq_complete

# === Scheduler Events ===
# Context switches show when threads go off-CPU
# WARNING: sched_switch can generate 100k+ events/sec on busy systems!
# Disabled by default - futex/fsync events provide sufficient off-CPU info
#
# To profile context switches specifically, use:
#   ./scripts/profile-reth-offcpu.sh op-reth-seq 60 ./profiling-configs/offcpu-events-contextswitches.conf
#
# sched:sched_switch

# === Optional High-Frequency Events (DISABLED BY DEFAULT) ===
# Uncomment only if you need them and can handle large data files
# WARNING: These generate millions of events per second!
#
# syscalls:sys_enter_read
# syscalls:sys_enter_write
# syscalls:sys_enter_pread64
# syscalls:sys_enter_pwrite64

# === Additional Useful Events (commented out) ===
# Uncomment as needed for specific investigations
#
# Network I/O:
# syscalls:sys_enter_sendto
# syscalls:sys_enter_recvfrom
# syscalls:sys_enter_sendmsg
# syscalls:sys_enter_recvmsg
#
# Poll/Select (can show async I/O waits):
# syscalls:sys_enter_epoll_wait
# syscalls:sys_enter_poll
# syscalls:sys_enter_select
#
# Sleep/Wait operations:
# syscalls:sys_enter_nanosleep
# syscalls:sys_enter_clock_nanosleep
